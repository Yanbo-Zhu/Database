


# 1 Mongosh

下载 .msi 文件 
安装在 C:\Users\yzh\AppData\Local\Programs\mongosh\


# 2 安装 MongoDB


## 2.1 Linux 上的单机版

版的安装包。

❶创建`MongoDB`目录，并通过工具上传安装包至服务器（或虚拟机）：

```shell
[root@~]# mkdir /soft && mkdir /soft/mongodb/
[root@~]# cd /soft/mongodb/
```

如果不想这么麻烦，也可以用`wget`命令在线拉取安装包：

```shell
[root@~]# wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-6.0.8.tgz
```

没有`wget`命令，可以通过`yum`安装一下：

```shell
[root@~]# yum -y install wget
```

❷解压相应目录下的安装包，并重命名解压后的目录：

```shell
[root@~]# tar -xvzf mongodb-linux-x86_64-rhel70-6.0.8.tgz
[root@~]# mv mongodb-linux-x86_64-rhel70-6.0.8 mongodb6.0.8
```

由于我们下载的是压缩包，属于开箱即用版，无需任何额外配置。但为了方便启动，咱们可以将`bin`目录拷贝出来：

```shell
[root@~]# cp -a /soft/mongodb/mongodb6.0.8/bin /soft/mongodb/bin
```

❸创建单机版`MongoDB`存储配置文件、数据、日志的目录：

```shell
[root@~]# mkdir /soft/mongodb/data && 
          mkdir /soft/mongodb/log && 
          mkdir /soft/mongodb/conf && 
          mkdir /soft/mongodb/data/standalone && 
          mkdir /soft/mongodb/log/standalone && 
          mkdir /soft/mongodb/conf/standalone
```

❹编写`MongoDB`核心配置文件（没有会自动创建）：

```shell
[root@~]# vi /soft/mongodb/conf/standalone/mongodb.conf
```

这里大家可以直接复制下述`yaml`配置，配置的具体含义可参考注释（也支持传统`.conf`形式配置）：

```shell
# MongoDB日志存储相关配置
systemLog:
    # 将所有日志写到指定文件中
    destination: file
    # 记录所有日志信息的文件路径
    path: "/soft/mongodb/log/standalone/mongodb.log"
    # 当服务重启时，将新日志以追加形式写到现有日志尾部
    logAppend: true
# 指定MongoDB存储数据的目录
storage:
    dbPath: "/soft/mongodb/data/standalone"
# 以后台进程方式运行MongoDB服务
processManagement:
    fork: true
# ------ MongoDB网络相关配置 ------
net:
    # 绑定服务实例的IP，默认是localhost，0.0.0.0表示任意IP（线上换成具体IP）
    bindIp: 0.0.0.0
    #绑定的端口，默认是27017
    port: 27017
```

复制时记住把数据、日志的目录，改成自己前面新建的，接着按下`Esc`，输入`:wq`保存退出。



### 2.1.1 启动,测试和关闭

❺启动`Mongo`服务，这里和`Redis`类似，都是以启动脚本+配置文件的方式：

```shell
[root@~]# /soft/mongodb/bin/mongod -f /soft/mongodb/conf/standalone/mongodb.conf
```

看到`successfully`表示启动成功，大家也可以通过`ps`命令来查看后台进程，确保正常启动：

```shell
[root@~]# ps aux | grep mongod
```

❻连接`MongoDB`测试是否可以正常使用，不过下述命令只适用于`6.x`以下：

```shell
[root@~]# /soft/mongodb/bin/mongo -port 27017
```



❼关闭`MongoDB`服务，这里有三种方式：

```shell
# 1.通过启动项来关闭
[root@~]# /soft/mongodb/bin/mongod --shutdown -f /soft/mongodb/conf/standalone/mongodb.conf

# 2.先通过客户端连接MongoDB服务，再进入admin库关闭（执行完后客户端会报连接出错）
[root@~]# /soft/mongodb/bin/mongosh -port 27017
test> use admin;
test> db.shutdownServer();

# 3.通过kill命令+进程号强杀进程
[root@~]# kill -9 [pid]
```

一般推荐使用前面两种，因为`kill`强杀进程，可能会导致数据损坏，如果损坏则需手动修复：

```shell
# 先删除数据目录下的所有锁文件
[root@~]# rm -rf /soft/mongodb/data/standalone/*.lock
# 再通过启动项对数据目录进行修复
[root@~]# /soft/mongodb/bin/mongod  --repair --dbpath=/soft/mongodb/data/standalone
```


## 2.2 使用的docker 

- image 名字 为 `mongodb/mongodb-community-server:latest`
- 产生 container 
    - `docker run --name mongodb -p 27017:27017 -d mongodb/mongodb-community-server:latest`
- Connect to the MongoDB Deployment with mongosh
    - `mongosh --port 27017`




# 3 MongoSH


到了`MongoDB6.x`版本，官方不再默认内置`Shell`客户端工具，想要使用则需额外下载：[官方Shell工具](https://link.juejin.cn?target=https%3A%2F%2Fwww.mongodb.com%2Fdocs%2Fmongodb-shell%2Finstall%2F "https://www.mongodb.com/docs/mongodb-shell/install/")，这里咱们照样以`wget`方式下载：

```shell
[root@~]# wget https://downloads.mongodb.com/compass/mongosh-1.10.3-linux-x64.tgz
```

接着将其解压，并拷贝`bin`目录下的`Shell`工具，放到原本的`bin`目录中：

```shell
[root@~]# tar -zxvf mongosh-1.10.3-linux-x64.tgz
[root@~]# cp /soft/mongodb/mongosh-1.10.3-linux-x64/bin/mongosh /soft/mongodb/bin/
```

然后再通过`mongosh`来连接测试：

```shell
[root@~]# /soft/mongodb/bin/mongosh -port 27017
test> show dbs;
```

如果上述操作执行完成后，能正常显示三个默认库，说明`MongoDB`安装成功。



# 4 Mongo Compuss 

为了外部可以连接，需要开放`MongoDB`端口、更新防火墙（关闭防火墙也行）：

```shell
[root@~]# firewall-cmd --zone=public --add-port=27017/tcp --permanent
[root@~]# firewall-cmd --reload
[root@~]# firewall-cmd --zone=public --list-ports
```

开放端口后，就可以通过可视化工具来连接操作了（如果你通过`Navicat`工具连接，是看不到三个默认库的）。



